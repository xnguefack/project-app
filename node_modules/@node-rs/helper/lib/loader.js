"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadBinding = void 0;
const fs_1 = require("fs");
const os_1 = require("os");
const path_1 = require("path");
const triples_1 = require("@napi-rs/triples");
const ArchName = os_1.arch();
const PlatformName = os_1.platform();
function loadBinding(dirname, filename = 'index', packageName) {
    const triples = triples_1.platformArchTriples[PlatformName][ArchName];
    for (const triple of triples) {
        if (packageName) {
            try {
                return require(require.resolve(`${packageName}-${triple.platformArchABI}`, { paths: [dirname] }));
            }
            catch (e) { }
        }
        const localFilePath = path_1.join(dirname, `${filename}.${triple.platformArchABI}.node`);
        if (fs_1.existsSync(localFilePath)) {
            return require(localFilePath);
        }
    }
    const errorMsg = `Can not find node binding files from ${packageName ? triples.map((triple) => `${packageName}-${triple.platformArchABI}`).join(', ') : ''} ${packageName ? 'and ' : ''}${triples
        .map((triple) => path_1.join(dirname, `${filename}.${triple.platformArchABI}.node`))
        .join(', ')}`;
    throw new TypeError(errorMsg);
}
exports.loadBinding = loadBinding;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xvYWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQkFBK0I7QUFDL0IsMkJBQW1DO0FBQ25DLCtCQUEyQjtBQUUzQiw4Q0FBc0Q7QUFFdEQsTUFBTSxRQUFRLEdBQUcsU0FBSSxFQUFFLENBQUE7QUFDdkIsTUFBTSxZQUFZLEdBQUcsYUFBUSxFQUFFLENBQUE7QUFFL0IsU0FBZ0IsV0FBVyxDQUFDLE9BQWUsRUFBRSxRQUFRLEdBQUcsT0FBTyxFQUFFLFdBQW9CO0lBQ25GLE1BQU0sT0FBTyxHQUFHLDZCQUFtQixDQUFDLFlBQVksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzNELEtBQUssTUFBTSxNQUFNLElBQUksT0FBTyxFQUFFO1FBRTVCLElBQUksV0FBVyxFQUFFO1lBQ2YsSUFBSTtnQkFDRixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsV0FBVyxJQUFJLE1BQU0sQ0FBQyxlQUFlLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2FBRWxHO1lBQUMsT0FBTyxDQUFDLEVBQUUsR0FBRTtTQUNmO1FBQ0QsTUFBTSxhQUFhLEdBQUcsV0FBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLFFBQVEsSUFBSSxNQUFNLENBQUMsZUFBZSxPQUFPLENBQUMsQ0FBQTtRQUNqRixJQUFJLGVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRTtZQUM3QixPQUFPLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQTtTQUM5QjtLQUNGO0lBRUQsTUFBTSxRQUFRLEdBQUcsd0NBQ2YsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxHQUFHLFdBQVcsSUFBSSxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQ2pHLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxPQUFPO1NBQ3BDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsV0FBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLFFBQVEsSUFBSSxNQUFNLENBQUMsZUFBZSxPQUFPLENBQUMsQ0FBQztTQUM1RSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQTtJQUVmLE1BQU0sSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUE7QUFDL0IsQ0FBQztBQXZCRCxrQ0F1QkMifQ==